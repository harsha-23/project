<style>
    .control-label {
        text-align: left !important;
    }

    .s2m1 {
        width: 100%;
    }
    .showRule{
        display: none;
    }
    .showCloneRule{
        display: none;
    }
</style>


<div class="row">
    <div class="col-md-12 col-sm-12">
        <div class="portlet light ">
            <div class="portlet-title">
                <div class="caption caption-md">
                    <i class="icon-magnifier font-green"></i>
                    <span class="caption-subject font-green sbold uppercase">EMI status</span>
                </div>
            </div>
            <div class="portlet-body">
                <form class="form-horizontal form-bordered" id="EMIForm">



                    <div class="row">
                        <div class="col-md-3">
                            <div class="form-group">
                                <label class="control-label col-sm-12 text-left">From Date</label>
                                <div class="col-sm-12">
                                    <input type="text" name="date" id="date" readonly="true" ng-model="date"
                                    class="form-control">
                                </div>
                            </div>
                        </div>

                        <div class="col-md-3">
                            <div class="form-group">
                                <label class="control-label col-sm-12 text-left">To Date</label>
                                <div class="col-sm-12">
                                    <input type="text" name="tdate" id="tdate" readonly="true" ng-model="tdate"
                                    class="form-control">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label class="control-label col-sm-12 text-left">Lead</label>
                                <div class="col-sm-12">
                                    <input   type="text" class="form-control"
                                    name="lead" id="lead" ng-model="lead">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label class="control-label col-sm-12 text-left">Mobile Number</label>
                                <div class="col-sm-12">
                                    <input  onKeyUp="checkForClickToCall('mobile', 1)"
                                    onkeydown="checkForClickToCall('mobile',1)"
                                    onfocusout="checkForClickToCall('mobile',1)" type="number" class="form-control"
                                    name="mobile" id="mobile" ng-model="mobile">
                                </div>
                            </div>
                        </div>

                       


                    </div>

                    <div class="row">
                        <div class="col-md-3">
                            <div class="form-group">
                                <label class="control-label col-sm-12 text-left">City</label>
                                <div class="col-sm-12">
                                    <ui-select  ng-model="filter.city" class="form-control" theme="select2"
                                    title="Choose a city" style="padding: 0px; border:none;" 
                                    close-on-select="true" >
                                    <ui-select-match placeholder="Select city"
                                        style="height: -webkit-fill-available;line-height: 34px;    background-image: none; ">
                                        <i class="fa fa-close" style="color: #f36a5a;"
                                            ng-click="clear($event,'city','filter')"></i> &nbsp;
                                        {{$select.selected.name}}</ui-select-match>
                                    <ui-select-choices group-by="app.someGroupForParentCity"
                                        repeat="city.name as city in cityList | propsFilter: {name: $select.search}">
                                        <div ng-bind-html="city.name | highlight: $select.search"></div>
                            
                                    </ui-select-choices>
                                </ui-select>
                                <input type="hidden" name="city" id="city"
                                value="{{filter.city}}" />
                                </div>
                            </div>
                        </div>



                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="control-label col-sm-12 ">Select Vendor</label>
                                <div class="col-sm-12">
                                    <select class="form-control" name="vendor" id="vendor" ng-model="vendor">
                                        <option value="">Please Select</option>
                                        <option value="{{vendor}}" ng-repeat="vendor in vendorList">{{vendor}}</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-3">
                            <div class="form-group">
                                <label class="control-label col-sm-12 text-left">Patient Name</label>
                                <div class="col-sm-12">
                                    <input   type="text" class="form-control"
                                    name="patientName" id="patientName" ng-model="patientName">
                                </div>
                            </div>
                        </div>


                       



                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="control-label col-sm-12 ">Select Status</label>
                                <div class="col-sm-12">
                                    <select class="form-control" name="status" id="status" ng-model="status">
                                        <option value="">Please Select</option>
                                        <option value="{{status}}" ng-repeat="status in statusList">{{status}}</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                    </div>

                    

                    <div class="row">
                        <div class="col-md-6" style="margin-top: 10px;">
                            <div class="col-md-4">
                                <input type="button" date-exportexcel="false" data-page="1"
                                    class="btn blue btn-block margin-top-20 green-haze" value="Submit"
                                    ng-click="submit(0);">
                            </div>
                            <div class="col-md-4">
                                <input type="button" ng-click="resetFilter()"
                                    class="btn blue btn-block margin-top-20 red-haze" value="Clear">
                            </div>
							<div class="col-md-4" ng-if="can('emi.estimate.filter.export')">
                                <input type="button" date-exportexcel="false" data-page="1"
                                    class="btn blue btn-block margin-top-20 green-haze" value="Export To Excel"
                                    ng-click="export(0);">
                            </div>
                        </div>
                    </div>

                </form>

            </div>
        </div>
    </div>
</div>



<div class="row"   ng-show="total > 0">
    <div class="col-md-12 col-sm-12">
        <div class="portlet light ">
            <div class="portlet-title">
                <div class="caption caption-md">
                    <i class="icon-list font-green"></i>
                    <span class="caption-subject font-green sbold uppercase"> LIST (LEAD COUNT -
                        {{total}})</span>
                </div>
            </div>
            <div class="portlet-body">
                <table class="table table-striped table-bordered table-advance table-hover" >
                    <thead>
                        <tr>
                           
                           
                            <th>Customer Info</th>
                           
                           
                          
                           
                            <th>EMI Details</th>
                           
                          
                            
                          
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="EMI in userList">
                            
                            <td style="width: 250px;padding-top: 50px;"><b style="float: left;">Lead ID:</b> {{EMI.leadId}}<br><br /> 
                            <b style="float: left;">Name :</b> {{EMI.patientName}}<br />  <br /> 
                            <b style="float: left;">Mobile :</b> <b ng-if="can('mobile.number.display.permission')">{{EMI.patientMobile}}</b><a href="#"
                                    ng-click="actions.makeConferenceCallByMobile({mobile:EMI.patientMobile,leadId:EMI.lead})"><i
                                        class="fa fa-phone"></i></a>
                                        <a class="btn btn-icon-only btn-circle popovers" data-toggle="popover" ng-click="actions.getMobileNumber({                                               
                                            lead: EMI.lsLeadId,                                               
                                        })"
                                        data-container="body" data-trigger="hover" data-placement="top"
                                        data-content="View mobile"
                                        data-original-title="Verify OTP" href="#"><i
                                            class="icon-eye font-green-sharp"></i></a>
                           
                            <br /> <br />
                           <b style="float: left;"> Employee Name :</b> {{EMI.employeeName}}
                            <br /> <br />
                            <b style="float: left;">Relation Ship  :</b> {{EMI.relationship}}
                            <br /> <br />
                           <b style="float: left;">Corporate Name  :</b> {{EMI.corporateName}}
                            </td>
                            <td>
                                <table class="table table-striped table-bordered table-advance table-hover">
                                  <tr>
                                    <th class="text-center text-success">EMI Info</th>
                                    <th  class="text-center text-success">Vendor Info</th>
                                    <th  class="text-center text-success">Additional Info</th>
                                   
                                  </tr>
                                    <tr ng-repeat="status in EMI.list">
                                        <td>
                                            <b style="float: left;"> Surgery Name  : </b> {{status.surgeryName}}<br /> <br />    <b style="float: left;">Surgery Date  : </b>    {{status.surgeryDate}}  <br /> <br />   <b style="float: left;">Surgery Amount  :</b>  {{status.surgeryAmount}} 
                                        </td>
                                        <td>
                                              <b style="float: left;"> Vendor Name  : </b>{{status.vendor}}
                                            <br>
                                            <br>
                                           
                                            <b style="float: left;"> Down Payment  : </b >{{status.downPayment}}
                                            
                                            <br>
                                            <br>
                                           
                                            <b style="float: left;">Tenure   : </b>{{status.tenure}}
                                            
                                            <br>
                                            <br>
                                           
                                            <b style="float: left;"> EMI  : </b>{{status.emi}}
                                            
                                            <br>
                                            <br>
                                           
                                            <b style="float: left;"> ROI  : </b>{{status.roi}}
                                            
                                            <br>
                                            <br>
                                           
                                            <b style="float: left;"> ProcessingFee  : </b>{{status.emiProcessing}}
                                           
                                            </td>
                                        <td style="width:276px;">
                
                                             <b style="float: left;"> Posted By  : </b> {{status.postedBy}} <br> <br>
                                              <b> Status  : </b> {{status.status}}  <br> <br>
                                           
                                             <a ng-if="can('emi.estimate.filter.display.vendor')" href="/emi-estimate/{{status.token}}"
                                            target="_blank">{{status.displayName}}</a>
                                            
                                            <br> <br>
                                          <span ng-if="can('emi.estimate.filter.add.vendor')">
                                            <button ng-if="status.associateFlag" class="btn btn-success btn-sm text-light mt-2" ng-click="addVendor(status.token)">  <i class="fa fa-plus" style="margin-right: 7%;"></i>Request for EMI</button>
                                        </span>
                                        <span ng-if="can('emi.estimate.filter.clone.vendor')">
                                            <button ng-if="status.cloneFlag"  class="btn btn-success btn-sm text-light mt-2" ng-click="cloneVendor(status.token,status,EMI)">  <i class="fa fa-plus" style="margin-right: 7%;"></i>Clone</button>
                                        </span>
                                        
                                        </td>
                                      
                                    </tr>
                                </table>

                             
                            
                            </td>
                           
                        
                          
                          
                          
                        </tr>
                    </tbody>
                </table>
               
            


                <div class="row " ng-show="userList.length > 0">
                    <div class="col-sm-12 text-right">
                        <!-- pagination -->
                        <div paging page="currentPage" page-size="pageSize" total="total" show-prev-next="true"
                            text-next="next" text-prev="prev" paging-action="pagination('Paging Clicked', page)">
                        </div>

                    </div>
                </div>

            </div>
        </div>
    </div>
</div>



<div class="modal fade" id="AddModal" role="dialog">
    <div class="modal-dialog" style="width: 60%;">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                <h4 class="modal-title">Add Vendor</h4>
            </div>
            <div class="modal-body">
                <form class="form-horizontal" id="addVendorForm">

                    <div class="row">
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="control-label col-sm-12 text-left">Vendor</label>
                                <div class="col-sm-12">
                                    <select class="form-control" ng-change="showEMIRules()" name="vendorStatus" id="vendorStatus" ng-model="vendorStatus">
                                        <option value="">Please Select</option>
                                        <option value="{{vendor}}" ng-repeat="vendor in vendorList">{{vendor}}</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="control-label col-sm-12 text-left">EMI Rules</label>
                                <div class="col-sm-12">
                                    <select class="form-control" ng-change="showAllEMIRules()" name="emiRules" id="emiRules" ng-model="emiRules">
                                        <option value="">Please Select</option>
                                        <option value="{{vendor.ruleId}}" ng-repeat="vendor in data">{{vendor.ruleName}}</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        

                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="control-label col-sm-12 text-left">Enter Your Comments</label>
                                <div class="col-sm-12">
                                    <textarea id="comments" name="comments" class="form-control"
                                    ng-model="comments"></textarea>
                                </div>
                            </div>
                        </div>


                    </div>

                    <div class="showRule">
                    <div class="row">
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="control-label col-sm-12 text-left">EMI</label>
                                <div class="col-sm-12">
                                    <input   type="text" class="form-control"
                                    name="emi" id="emi" ng-model="emi" readonly>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="control-label col-sm-12 text-left">Tenure</label>
                                <div class="col-sm-12">
                                    <input   type="text" class="form-control"
                            name="tenure" id="tenure" ng-model="tenure" readonly>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="control-label col-sm-12 text-left">Down Payment</label>
                                <div class="col-sm-12">
                                    <input   type="text" class="form-control"
                                    name="downPayment" id="downPayment" ng-model="downPayment" readonly>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="control-label col-sm-12 text-left">ROI</label>
                                <div class="col-sm-12">
                                    <input   type="text" class="form-control"
                                    name="roi" id="roi" ng-model="roi" readonly>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="control-label col-sm-12 text-left">Processing Fee</label>
                                <div class="col-sm-12">
                                    <input   type="text" class="form-control"
                            name="procFee" id="procFee" ng-model="procFee" readonly>
                                </div>
                            </div>
                        </div>
                    </div>
                   </div>
                   
                  
                    
                  
                 
               
                  

                    
                    
                </form>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-info btn-mdm" ng-click="submitVendor()">
                    <strong><strong>Add</strong></strong>
                </button>
                <button type="button" class="btn dark btn-outline" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="cloneModal" role="dialog">
    <div class="modal-dialog" style="width: 60%;">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                <h4 class="modal-title">Clone request</h4>
            </div>
            <div class="modal-body">
                <form class="form-horizontal" id="cloneVendorForm">
                    <div class="row">
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="control-label col-sm-12 text-left">Surgery Name</label>
                                <div class="col-sm-12">
                                    <input   type="text" class="form-control"
                                    name="surgeryName" id="surgeryName" ng-model="surgeryName">
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="control-label col-sm-12 text-left">Surgery Date</label>
                                <div class="col-sm-12">
                                    <input type="text" name="surgeryDate" id="surgeryDate" readonly="true" ng-model="surgeryDate"
                                    class="form-control">
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="control-label col-sm-12 text-left">Surgery Amount</label>
                                <div class="col-sm-12">
                                    <input   type="text" class="form-control"
                                    name="surgeryAmount" id="surgeryAmount" ng-model="surgeryAmount">
                                </div>
                            </div>
                        </div>

                        

                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="control-label col-sm-12 text-left">Relationship</label>
                                <div class="col-sm-12">
                                    <select class="form-control" name="relationship" id="relationship" ng-model="relationship">
                                        <option value="">Please Select</option>
                                        <option value="{{relation}}" ng-repeat="relation in relationList">{{relation}}</option>
                                    </select>
                                </div>
                            </div>
                        </div>


                    </div>

                    <div class="row">
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="control-label col-sm-12 text-left">Vendor</label>
                                <div class="col-sm-12">
                                    <select class="form-control" ng-change="showEMIRulesForClone()" name="vendorCloneStatus" id="vendorCloneStatus" ng-model="vendorCloneStatus">
                                        <option value="">Please Select</option>
                                        <option value="{{vendor}}" ng-repeat="vendor in vendorList">{{vendor}}</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="control-label col-sm-12 text-left">EMI Rules</label>
                                <div class="col-sm-12">
                                    <select class="form-control" ng-change="showAllEMIRulesForClone()" name="emiRulesClone" id="emiRulesClone" ng-model="emiRulesClone">
                                        <option value="">Please Select</option>
                                        <option value="{{vendor.ruleId}}" ng-repeat="vendor in data">{{vendor.ruleName}}</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-3" >
                            <div class="form-group">
                                <label class="control-label col-sm-12 text-left">Processing Fee</label>
                                <div class="col-sm-12">
                                    <input   type="text" class="form-control"
                            name="procFee" id="procFee" ng-model="procFee" readonly>
                                </div>
                            </div>
                        </div>

                       
                         <div class="col-sm-3">
                            <div class="form-group">
                                <label class="control-label col-sm-12 text-left">City</label>
                                <div class="col-sm-12">
                                    <ui-select  ng-model="filter.cityClone" class="form-control" theme="select2"
                                    title="Choose a city" style="padding: 0px; border:none;" 
                                    close-on-select="true" >
                                    <ui-select-match placeholder="Select city"
                                        style="height: -webkit-fill-available;line-height: 34px;    background-image: none; ">
                                        <i class="fa fa-close" style="color: #f36a5a;"
                                            ng-click="clear($event,'city','filter')"></i> &nbsp;
                                        {{$select.selected.name}}</ui-select-match>
                                    <ui-select-choices group-by="app.someGroupForParentCity"
                                        repeat="city.name as city in cityList | propsFilter: {name: $select.search}">
                                        <div ng-bind-html="city.name | highlight: $select.search"></div>
                            
                                    </ui-select-choices>
                                </ui-select>
                                <input type="hidden" name="cityClone" id="cityClone"
                                value="{{filter.cityClone}}" />
                                </div>
                            </div>
                        </div>


                    </div>

                    <div class="showCloneRule">
                    <div class="row">
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="control-label col-sm-12 text-left">EMI</label>
                                <div class="col-sm-12">
                                    <input   type="text" class="form-control"
                                    name="emi" id="emi" ng-model="emi" readonly>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="control-label col-sm-12 text-left">Tenure</label>
                                <div class="col-sm-12">
                                    <input   type="text" class="form-control"
                            name="tenure" id="tenure" ng-model="tenure" readonly>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="control-label col-sm-12 text-left">Down Payment</label>
                                <div class="col-sm-12">
                                    <input   type="text" class="form-control"
                                    name="downPayment" id="downPayment" ng-model="downPayment" readonly>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="control-label col-sm-12 text-left">ROI</label>
                                <div class="col-sm-12">
                                    <input   type="text" class="form-control"
                                    name="roi" id="roi" ng-model="roi" readonly>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
              
                    <div class="row">
                        
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="control-label col-sm-12 text-left">Enter Your Comments</label>
                                <div class="col-sm-12">
                                    <textarea id="commentsClone" name="commentsClone" class="form-control"
                                    ng-model="commentsClone"></textarea>
                                </div>
                            </div>
                        </div>


                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="control-label col-sm-12 text-left">Corporate Name</label>
                                <div class="col-sm-12">
                                    <input   type="text" class="form-control"
                            name="corporateName" id="corporateName" ng-model="corporateName" readonly>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="control-label col-sm-12 text-left">Employee Name</label>
                                <div class="col-sm-12">
                                    <input   type="text" class="form-control"
                            name="employeeName" id="employeeName" ng-model="employeeName" >
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="control-label col-sm-12 text-left">Employee Id</label>
                                <div class="col-sm-12">
                                    <input   type="text" class="form-control"
                            name="employeeId" id="employeeId" ng-model="employeeId" >
                                </div>
                            </div>
                        </div>

                    </div>
                 
                   
                  
                    
                  
                 
               
                  

                    
                    
                </form>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-info btn-mdm" ng-click="submitClone()">
                    <strong><strong>Add</strong></strong>
                </button>
                <button type="button" class="btn dark btn-outline" ng-click="hideClone()" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<script>
    (function () {
        $('#EMIForm').validate({
            errorElement: 'span', //default input error message container
            errorClass: 'help-block help-block-error', // default input error message class
            focusInvalid: false, // do not focus the last invalid input
            ignore: "", // validate all fields including form hidden input
            rules: {



                date: {
                    required: true,

                },
                tdate: {
                    required: true,

                }


            },
            messages: {
                service: "Please select the service.",
                city: "Please select the city.",
                date: "date is required",
                tdate: "date is required",


                prospect: "Please select the speciality"


            },
            highlight: function (element) { // hightlight error inputs
                $(element)
                    .closest('.form-group').addClass(
                        'has-error'); // set error class to the control group
            },
            unhighlight: function (element) { // revert the change done by hightlight
                $(element)
                    .closest('.form-group').removeClass(
                        'has-error'); // set error class to the control group
            },
            success: function (label) {
                label
                    .closest('.form-group').removeClass(
                        'has-error'); // set success class to the control group
            },

        });






        $('#addVendorForm').validate({
            errorElement: 'span', //default input error message container
            errorClass: 'help-block help-block-error', // default input error message class
            focusInvalid: false, // do not focus the last invalid input
            ignore: "", // validate all fields including form hidden input
            rules: {



                vendorStatus: {
                    required: true,

                },
                emiRules: {
                    required: true,

                },
                addStatus:{
                    required:true
                },
                comments:{
                    required:true
                }


            },
            messages: {
                service: "Please select the service.",
                city: "Please select the city.",
                date: "date is required",
                tdate: "date is required",


                prospect: "Please select the speciality"


            },
            highlight: function (element) { // hightlight error inputs
                $(element)
                    .closest('.form-group').addClass(
                        'has-error'); // set error class to the control group
            },
            unhighlight: function (element) { // revert the change done by hightlight
                $(element)
                    .closest('.form-group').removeClass(
                        'has-error'); // set error class to the control group
            },
            success: function (label) {
                label
                    .closest('.form-group').removeClass(
                        'has-error'); // set success class to the control group
            },

        });


        $('#cloneVendorForm').validate({
            errorElement: 'span', //default input error message container
            errorClass: 'help-block help-block-error', // default input error message class
            focusInvalid: false, // do not focus the last invalid input
            ignore: "", // validate all fields including form hidden input
            rules: {



                vendorCloneStatus: {
                    required: true,

                }


            },
            messages: {
                service: "Please select the service.",
                city: "Please select the city.",
                date: "date is required",
                tdate: "date is required",


                prospect: "Please select the speciality"


            },
            highlight: function (element) { // hightlight error inputs
                $(element)
                    .closest('.form-group').addClass(
                        'has-error'); // set error class to the control group
            },
            unhighlight: function (element) { // revert the change done by hightlight
                $(element)
                    .closest('.form-group').removeClass(
                        'has-error'); // set error class to the control group
            },
            success: function (label) {
                label
                    .closest('.form-group').removeClass(
                        'has-error'); // set success class to the control group
            },

        });



    })();
</script>
<script src="/js/internationalMobileInitiazation.js" type="text/javascript"></script>